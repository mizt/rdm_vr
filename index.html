<!DOCTYPE html><html lang="en"><head><title>rdm.vr</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"><link href="./favicon.ico"><style>canvas#view,div#rdm{width:100%;height:100%}body{margin:0;padding:0;overflow:hidden;cursor:pointer}#vr-container{position:absolute;top:0;left:0;right:0;bottom:0;z-index:0}div#rdm{position:absolute;pointer-events:none;z-index:242}canvas#view{background-color:grey}</style></head><body><div id="rdm"><canvas id="view"></canvas></div><div id="vr-container"></div><script src="./third-party/threejs/three.min.js"></script><script src="./third-party/threejs/StereoEffect.min.js"></script><script src="./third-party/threejs/DeviceOrientationControls.min.js"></script><script src="./third-party/threejs/OrbitControls.min.js"></script><script src="libs.js"></script><script>function init(){renderer=new THREE.WebGLRenderer,element=renderer.domElement,container=document.getElementById("vr-container"),container.appendChild(element),effect=new THREE.StereoEffect(renderer),scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(90,1,.001,1e4),camera.position.set(0,10,0),scene.add(camera),setupControlls();var e=new THREE.Mesh(new THREE.SphereGeometry(1e3,32,32),new THREE.MeshBasicMaterial({map:photoSphereTexture()}));e.scale.x=-1,e.rotation.y+=165*Math.PI/180,scene.add(e),window.addEventListener("resize",resize,!1),setTimeout(resize,0)}function setupControlls(){function e(t){t.alpha&&(controls=new THREE.DeviceOrientationControls(camera,!0),controls.connect(),controls.update(),element.addEventListener("click",fullscreen,!1),window.removeEventListener("deviceorientation",e,!0))}controls=new THREE.OrbitControls(camera,element),controls.rotateUp(Math.PI/4),controls.target.set(camera.position.x+.1,camera.position.y,camera.position.z),controls.noZoom=!0,controls.noPan=!0,window.addEventListener("deviceorientation",e,!0)}function photoSphereTexture(){var e=new THREE.Texture;e.magFilter=THREE.LinearFilter,e.minFilter=THREE.LinearFilter;var t=document.createElement("img");return t.onload=function(){e.image=t,e.needsUpdate=!0},t.setAttribute("crossorigin","anonymous"),t.src=URL,e}function resize(){var e=container.offsetWidth,t=container.offsetHeight;camera.aspect=e/t,camera.updateProjectionMatrix(),renderer.setSize(e,t),effect.setSize(e,t)}function update(){controls.update()}function render(){effect.render(scene,camera)}function animate(){requestAnimationFrame(animate),update(),render();var e=document.querySelectorAll("canvas"),t=e[0]===view?e[1]:view;offscreenCtx.drawImage(t,0,0,t.width,t.height,0,0,WIDTH,HEIGHT);for(var n=offscreenCtx.getImageData(0,0,WIDTH,HEIGHT),r=n.data,o=0;o<size;o++)buf[o]=r[o];1==draw(buf.byteOffset)&&(n.data.set(buf),viewCtx.putImageData(n,0,0))}function fullscreen(){container.requestFullscreen?container.requestFullscreen():container.msRequestFullscreen?container.msRequestFullscreen():container.mozRequestFullScreen?container.mozRequestFullScreen():container.webkitRequestFullscreen&&container.webkitRequestFullscreen()}var WIDTH=512,HEIGHT=288,view=document.getElementById("view");view.width=WIDTH,view.height=HEIGHT;var offscreen=document.createElement("canvas");offscreen.width=WIDTH,offscreen.height=HEIGHT;var viewCtx=view.getContext("2d"),offscreenCtx=offscreen.getContext("2d"),size=view.width*view.height<<2,ptr=Module._malloc(size),buf=new Uint8Array(Module.HEAPU8.buffer,ptr,size),draw=Module.cwrap("draw","number",["number"]);Module.cwrap("setup","void",["number"])();var URL="texture.png";init(),animate();var camera,scene,renderer,effect,controls,element,container;</script></body></html>