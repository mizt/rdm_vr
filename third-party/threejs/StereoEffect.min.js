THREE.StereoEffect=function(t){this.separation=3,this.focalLength=15;var e,a,r,o,n,i,s,p,c,E,h,d,u=new THREE.Vector3,T=new THREE.Quaternion,f=new THREE.Vector3,R=new THREE.PerspectiveCamera,l=new THREE.PerspectiveCamera;t.autoClear=!1,this.setSize=function(r,o){e=r/2,a=o,t.setSize(r,o)},this.render=function(M,H){M.updateMatrixWorld(),void 0===H.parent&&H.updateMatrixWorld(),H.matrixWorld.decompose(u,T,f),r=THREE.Math.radToDeg(2*Math.atan(Math.tan(.5*THREE.Math.degToRad(H.fov)))),p=H.near/this.focalLength,E=Math.tan(.5*THREE.Math.degToRad(r))*this.focalLength,c=.5*E*H.aspect,i=E*p,s=-i,h=(c+this.separation/2)/(2*c),d=1-h,o=2*c*p*d,n=2*c*p*h,R.projectionMatrix.makeFrustum(-o,n,s,i,H.near,H.far),R.position.copy(u),R.quaternion.copy(T),R.translateX(-this.separation/2),l.projectionMatrix.makeFrustum(-n,o,s,i,H.near,H.far),l.position.copy(u),l.quaternion.copy(T),l.translateX(this.separation/2),t.setViewport(0,0,2*e,a),t.clear(),t.setViewport(0,0,e,a),t.render(M,R),t.setViewport(e,0,e,a),t.render(M,l)}};